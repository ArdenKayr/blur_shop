{% extends 'base.html' %}

{% block content %}

<div class="text-xs uppercase tracking-widest text-gray-400 mb-8">
    <a href="{% url 'catalog' %}" class="hover:text-rosegold transition">Каталог</a>
    <span class="mx-2">/</span>
    {% if product.category %}
        <a href="{% url 'category_detail' product.category.slug %}" class="hover:text-rosegold transition">{{ product.category.name }}</a>
        <span class="mx-2">/</span>
    {% endif %}
    <span class="text-gray-800">{{ product.name }}</span>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-12 lg:gap-20 mb-20">
    
    <div class="relative bg-[#F9F9F9] rounded-2xl overflow-hidden aspect-square border border-gray-50 group">
        {% if product.image %}
            <img src="{{ product.image.url }}" alt="{{ product.name }}" 
                 class="w-full h-full object-cover object-center group-hover:scale-105 transition-transform duration-700">
        {% else %}
            <div class="w-full h-full flex items-center justify-center text-gray-300">
                <i class="fa-solid fa-camera text-6xl"></i>
            </div>
        {% endif %}
        
        {% if product.is_new %}
            <div class="absolute top-6 left-6">
                <span class="bg-rosegold text-white text-[10px] font-bold px-3 py-1 uppercase tracking-widest rounded-full shadow-md">New</span>
            </div>
        {% endif %}
    </div>

    <div class="flex flex-col justify-center">
        
        <h1 class="text-4xl lg:text-5xl font-serif font-bold text-gray-900 mb-4 leading-tight">
            {{ product.name }}
        </h1>
        
        <div class="mb-8 flex items-baseline space-x-4">
            {% if user.is_authenticated and user.status == 'approved' %}
                <span class="text-3xl font-bold text-rosegold-dark">{{ product.price_pro }} ₽</span>
                <span class="text-sm text-gray-400 line-through">{{ product.price_retail }} ₽</span>
                <span class="bg-green-100 text-green-700 text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wide">Pro Price</span>
            {% else %}
                <span class="text-3xl font-bold text-gray-900">{{ product.price_retail }} ₽</span>
                {% if user.is_authenticated and user.status == 'client' %}
                    <a href="{% url 'upgrade_pro' %}" class="text-xs text-rosegold underline hover:no-underline ml-2">Цена для косметолога?</a>
                {% endif %}
            {% endif %}
        </div>

        <div class="text-gray-600 leading-relaxed mb-8 font-light">
            {{ product.description|linebreaks }}
        </div>

        {% if product.filters.all %}
        <div class="mb-8 border-t border-b border-gray-100 py-6">
            <h4 class="text-xs font-bold text-gray-900 uppercase tracking-widest mb-4">Характеристики</h4>
            <div class="grid grid-cols-2 gap-4">
                {% for filter in product.filters.all %}
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-500">{{ filter.group.name }}</span>
                        <span class="font-medium text-gray-900">{{ filter.value }}</span>
                    </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <div class="flex space-x-4">
            <form action="{% url 'cart_add' product.id %}" method="post" class="flex-1">
                {% csrf_token %}
                <button type="submit" class="w-full bg-gray-900 hover:bg-rosegold text-white font-bold py-4 rounded-xl transition uppercase text-xs tracking-widest shadow-lg hover:shadow-xl transform hover:-translate-y-1">
                    Добавить в корзину
                </button>
            </form>
            
            <button class="w-14 h-14 border border-gray-200 rounded-xl flex items-center justify-center text-gray-400 hover:text-red-400 hover:border-red-200 transition">
                <i class="fa-regular fa-heart text-xl"></i>
            </button>
        </div>

    </div>
</div>

{% if related_products %}
<div class="border-t border-gray-100 pt-16">
    <h3 class="text-2xl font-serif font-bold text-gray-900 mb-8 text-center">Вам может понравиться</h3>
    <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
        {% for related in related_products %}
            <a href="{% url 'product_detail' related.id %}" class="group block">
                <div class="relative bg-[#F9F9F9] rounded-xl overflow-hidden aspect-[4/5] mb-4">
                    {% if related.image %}
                        <img src="{{ related.image.url }}" class="w-full h-full object-cover group-hover:scale-105 transition duration-500">
                    {% else %}
                        <div class="w-full h-full flex items-center justify-center text-gray-300"><i class="fa-solid fa-camera"></i></div>
                    {% endif %}
                </div>
                <h4 class="font-bold text-gray-900 group-hover:text-rosegold transition">{{ related.name }}</h4>
                <p class="text-sm text-gray-500 mt-1">{{ related.price_retail }} ₽</p>
            </a>
        {% endfor %}
    </div>
</div>
{% endif %}

{% endblock %}
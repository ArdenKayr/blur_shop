{% extends 'base.html' %}
{% load product_extras %} 

{% block content %}
<div class="max-w-6xl mx-auto">
    <nav class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-8">
        <a href="{% url 'catalog' %}" class="hover:text-rosegold transition">Каталог</a>
        <span class="mx-2">/</span>
        {% if product.category %}
            <a href="{% url 'category_detail' product.category.slug %}" class="hover:text-rosegold transition">{{ product.category.name }}</a>
            <span class="mx-2">/</span>
        {% endif %}
        <span class="text-gray-800">{{ product.name }}</span>
    </nav>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-12 mb-20">
        <div class="relative bg-white rounded-3xl overflow-hidden shadow-sm border border-gray-100 group">
            {% if product.image %}
                <img src="{{ product.image.url }}" alt="{{ product.name }}" class="w-full h-auto object-cover transform group-hover:scale-105 transition duration-700">
            {% else %}
                <div class="w-full h-96 bg-gray-50 flex items-center justify-center text-gray-300">
                    <i class="fa-regular fa-image text-4xl"></i>
                </div>
            {% endif %}
        </div>

        <div class="flex flex-col justify-center">
            <h1 class="text-3xl md:text-4xl font-serif font-bold text-gray-900 mb-4 leading-tight">
                {{ product.name }}
            </h1>
            
            <div class="text-2xl text-rosegold font-bold mb-6 font-serif flex items-center gap-3">
                <span>{{ product.display_price }} ₽</span>
                
                {% if product.display_price < product.price_retail %}
                    <span class="text-sm text-gray-400 font-normal line-through">{{ product.price_retail }} ₽</span>
                    <span class="text-[10px] bg-green-100 text-green-600 px-2 py-1 rounded-full font-bold uppercase tracking-wide">
                        {% if user.is_cosmetologist and user.is_manicurist %}
                            Спец. цена
                        {% elif user.is_cosmetologist %}
                            Косметолог
                        {% elif user.is_manicurist %}
                            Мастер
                        {% endif %}
                    </span>
                {% endif %}
            </div>

            <div class="prose text-gray-500 mb-8 font-light leading-relaxed">
                {{ product.description|linebreaks }}
            </div>

            <div class="flex items-center space-x-4 border-t border-gray-100 pt-8">
                <form action="{% url 'cart_add' product.id %}" method="post" class="flex-grow max-w-xs">
                    {% csrf_token %}
                    <button type="submit" class="w-full py-4 bg-gray-900 text-white font-bold uppercase tracking-widest text-xs hover:bg-rosegold transition rounded-full shadow-lg transform hover:-translate-y-0.5">
                        В корзину
                    </button>
                </form>

                {% is_favorite product as fav_status %}
                <a href="{% url 'toggle_favorite' product.id %}" 
                   class="w-12 h-12 flex items-center justify-center border border-gray-200 rounded-full hover:border-rosegold hover:shadow-md transition group bg-white"
                   title="{% if fav_status %}Убрать из избранного{% else %}Добавить в избранное{% endif %}">
                    {% if fav_status %}
                        <i class="fa-solid fa-heart text-rosegold text-xl animate-pulse"></i>
                    {% else %}
                        <i class="fa-regular fa-heart text-gray-400 group-hover:text-rosegold text-xl transition"></i>
                    {% endif %}
                </a>
            </div>

            <div class="mt-8 space-y-2 text-xs text-gray-400 uppercase tracking-wider">
                <p>Артикул: <span class="text-gray-900">BL-{{ product.id }}</span></p>
                {% if product.category %}
                <p>Категория: <a href="{% url 'category_detail' product.category.slug %}" class="text-gray-900 hover:text-rosegold border-b border-gray-200 hover:border-rosegold transition">{{ product.category.name }}</a></p>
                {% endif %}
            </div>
        </div>
    </div>

    {% if product.description %}
    <div class="border-t border-gray-100 pt-16">
        <h3 class="text-2xl font-serif font-bold text-center mb-8">Подробнее о продукте</h3>
        <div class="max-w-3xl mx-auto text-center text-gray-600 font-light leading-relaxed">
            {{ product.description|linebreaks }}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}